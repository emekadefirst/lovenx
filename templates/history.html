<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading History - LoveNX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --background: #ffffff;
            --foreground: #0a0a0a;
            --card: #ffffff;
            --card-foreground: #0a0a0a;
            --primary: #030213;
            --primary-foreground: #ffffff;
            --secondary: #f3f4f6;
            --secondary-foreground: #030213;
            --muted: #ececf0;
            --muted-foreground: #717182;
            --accent: #e9ebef;
            --accent-foreground: #030213;
            --destructive: #d4183d;
            --destructive-foreground: #ffffff;
            --border: rgba(0, 0, 0, 0.1);
            --ring: #9ca3af;
            --chart-1: #f59e0b;
            --chart-2: #10b981;
            --chart-3: #3b82f6;
            --chart-4: #8b5cf6;
            --chart-5: #ef4444;
            --radius: 0.625rem;
        }
        
        body {
            background-color: var(--background);
            color: var(--foreground);
        }
        
        .bg-background { background-color: var(--background); }
        .bg-card { background-color: var(--card); }
        .bg-primary { background-color: var(--primary); }
        .bg-secondary { background-color: var(--secondary); }
        .bg-muted { background-color: var(--muted); }
        .bg-accent { background-color: var(--accent); }
        .text-foreground { color: var(--foreground); }
        .text-primary { color: var(--primary); }
        .text-primary-foreground { color: var(--primary-foreground); }
        .text-muted-foreground { color: var(--muted-foreground); }
        .border-border { border-color: var(--border); }
        .text-chart-1 { color: var(--chart-1); }
        .text-chart-2 { color: var(--chart-2); }
        .text-chart-3 { color: var(--chart-3); }
        .text-chart-4 { color: var(--chart-4); }
        .text-chart-5 { color: var(--chart-5); }
        
        .status-completed { background-color: var(--chart-2); color: white; }
        .status-pending { background-color: var(--chart-1); color: white; }
        .status-cancelled { background-color: var(--chart-5); color: white; }
        
        .tab-button {
            padding: 8px 16px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background-color: var(--background);
            color: var(--foreground);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }
        
        .filter-input {
            background-color: var(--secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 8px 12px;
            transition: all 0.2s ease;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: var(--primary);
        }
    </style>
</head>
<body class="h-full bg-background text-foreground">
    <!-- Navigation -->
    <nav class="border-b border-border/40 bg-card">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="h-10 w-10">
                        <svg viewBox="0 0 48 48" class="w-full h-full" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="24" cy="24" r="20" stroke="url(#gradient1)" stroke-width="2" fill="none" class="opacity-80"/>
                            <path d="M24 8L36 24L24 40L12 24L24 8Z" fill="url(#gradient2)" class="opacity-90"/>
                            <path d="M24 16L30 24L24 32L18 24L24 16Z" fill="var(--primary-foreground)"/>
                            <path d="M10 28L16 24L22 26L28 22L34 26L38 24" stroke="url(#gradient1)" stroke-width="1.5" fill="none" class="opacity-60"/>
                            <defs>
                                <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="var(--primary)"/>
                                    <stop offset="100%" stop-color="var(--chart-1)"/>
                                </linearGradient>
                                <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="var(--primary)"/>
                                    <stop offset="50%" stop-color="var(--chart-1)"/>
                                    <stop offset="100%" stop-color="var(--primary)"/>
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-tight">
                            <span class="text-primary">love</span><span class="text-chart-1">nx</span>
                        </h1>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="index.html" class="nav-link text-foreground hover:text-primary transition-colors">Home</a>
                    <a href="trade.html" class="nav-link text-foreground hover:text-primary transition-colors">Trade</a>
                    <a href="history.html" class="nav-link text-primary font-medium transition-colors">History</a>
                    <a href="profile.html" class="nav-link text-foreground hover:text-primary transition-colors">Profile</a>
                </div>

                <!-- User Menu -->
                <div class="flex items-center space-x-4" id="userMenu">
                    <div class="relative">
                        <button class="flex items-center space-x-2 text-foreground hover:text-primary transition-colors" onclick="toggleDropdown()">
                            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-primary-foreground text-sm"></i>
                            </div>
                            <span id="userName">User</span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div id="dropdownMenu" class="absolute right-0 mt-2 w-48 bg-card border border-border rounded-lg shadow-lg hidden z-50">
                            <a href="profile.html" class="block px-4 py-2 text-foreground hover:bg-accent transition-colors">Profile</a>
                            <a href="history.html" class="block px-4 py-2 text-foreground hover:bg-accent transition-colors">History</a>
                            <button onclick="logout()" class="block w-full text-left px-4 py-2 text-foreground hover:bg-accent transition-colors">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-8">
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">Trading History</h1>
            <p class="text-muted-foreground">View and manage your trading history and transactions</p>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-card border border-border rounded-lg p-6">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-chart-2/10 rounded-full flex items-center justify-center">
                        <i class="fas fa-chart-line text-chart-2"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-muted-foreground">Total Trades</p>
                        <p class="text-2xl font-bold" id="totalTrades">127</p>
                    </div>
                </div>
            </div>

            <div class="bg-card border border-border rounded-lg p-6">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-chart-3/10 rounded-full flex items-center justify-center">
                        <i class="fas fa-dollar-sign text-chart-3"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-muted-foreground">Total Volume</p>
                        <p class="text-2xl font-bold" id="totalVolume">$48,532</p>
                    </div>
                </div>
            </div>

            <div class="bg-card border border-border rounded-lg p-6">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-chart-2/10 rounded-full flex items-center justify-center">
                        <i class="fas fa-arrow-up text-chart-2"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-muted-foreground">Profit/Loss</p>
                        <p class="text-2xl font-bold text-chart-2" id="profitLoss">+$2,847</p>
                    </div>
                </div>
            </div>

            <div class="bg-card border border-border rounded-lg p-6">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-chart-1/10 rounded-full flex items-center justify-center">
                        <i class="fas fa-percentage text-chart-1"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-muted-foreground">Win Rate</p>
                        <p class="text-2xl font-bold" id="winRate">68.5%</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters and Tabs -->
        <div class="bg-card border border-border rounded-lg p-6 mb-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                <!-- Tabs -->
                <div class="flex space-x-2">
                    <button class="tab-button active" onclick="setActiveTab('all')" id="allTab">All Orders</button>
                    <button class="tab-button" onclick="setActiveTab('completed')" id="completedTab">Completed</button>
                    <button class="tab-button" onclick="setActiveTab('pending')" id="pendingTab">Pending</button>
                    <button class="tab-button" onclick="setActiveTab('cancelled')" id="cancelledTab">Cancelled</button>
                </div>

                <!-- Filters -->
                <div class="flex space-x-4">
                    <select class="filter-input" id="pairFilter" onchange="filterData()">
                        <option value="">All Pairs</option>
                        <option value="BTC/USD">BTC/USD</option>
                        <option value="ETH/USD">ETH/USD</option>
                        <option value="SOL/USD">SOL/USD</option>
                        <option value="BNB/USD">BNB/USD</option>
                    </select>
                    
                    <input type="date" class="filter-input" id="dateFilter" onchange="filterData()">
                    
                    <button class="tab-button" onclick="exportData()">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>
                </div>
            </div>
        </div>

        <!-- Trading History Table -->
        <div class="bg-card border border-border rounded-lg overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-muted">
                        <tr>
                            <th class="px-6 py-4 text-left font-semibold">Date & Time</th>
                            <th class="px-6 py-4 text-left font-semibold">Pair</th>
                            <th class="px-6 py-4 text-left font-semibold">Type</th>
                            <th class="px-6 py-4 text-left font-semibold">Side</th>
                            <th class="px-6 py-4 text-right font-semibold">Amount</th>
                            <th class="px-6 py-4 text-right font-semibold">Price</th>
                            <th class="px-6 py-4 text-right font-semibold">Total</th>
                            <th class="px-6 py-4 text-center font-semibold">Status</th>
                            <th class="px-6 py-4 text-center font-semibold">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination -->
        <div class="flex items-center justify-between mt-6">
            <div class="text-sm text-muted-foreground">
                Showing <span id="showingStart">1</span> to <span id="showingEnd">10</span> of <span id="totalRecords">127</span> entries
            </div>
            <div class="flex space-x-2">
                <button class="tab-button" onclick="changePage(-1)" id="prevBtn">
                    <i class="fas fa-chevron-left mr-2"></i>Previous
                </button>
                <button class="tab-button" onclick="changePage(1)" id="nextBtn">
                    Next<i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Order Details Modal -->
        <div id="orderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-card border border-border rounded-lg p-6 max-w-md w-full mx-4">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">Order Details</h3>
                    <button onclick="closeModal()" class="text-muted-foreground hover:text-foreground">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="orderDetails" class="space-y-3">
                    <!-- Order details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'all';
        let currentPage = 1;
        const itemsPerPage = 10;
        let allOrders = [];
        let filteredOrders = [];

        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.classList.toggle('hidden');
        }

        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userName');
            localStorage.removeItem('userEmail');
            window.location.href = 'index.html';
        }

        function generateMockOrders() {
            const pairs = ['BTC/USD', 'ETH/USD', 'SOL/USD', 'BNB/USD'];
            const types = ['market', 'limit'];
            const sides = ['buy', 'sell'];
            const statuses = ['completed', 'pending', 'cancelled'];
            
            const orders = [];
            
            // Add stored orders from trading
            const storedOrders = JSON.parse(localStorage.getItem('orders') || '[]');
            storedOrders.forEach(order => {
                orders.push({
                    ...order,
                    id: Math.random().toString(36).substr(2, 9),
                    status: 'completed',
                    fee: (order.total * 0.001).toFixed(2) // 0.1% fee
                });
            });
            
            // Generate additional mock orders
            for (let i = orders.length; i < 127; i++) {
                const pair = pairs[Math.floor(Math.random() * pairs.length)];
                const type = types[Math.floor(Math.random() * types.length)];
                const side = sides[Math.floor(Math.random() * sides.length)];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                
                const basePrice = pair.includes('BTC') ? 43000 : 
                                pair.includes('ETH') ? 2700 : 
                                pair.includes('SOL') ? 100 : 315;
                
                const priceVariation = (Math.random() - 0.5) * 0.1 * basePrice;
                const price = basePrice + priceVariation;
                const amount = Math.random() * 2;
                const total = price * amount;
                
                const timestamp = new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000);
                
                orders.push({
                    id: Math.random().toString(36).substr(2, 9),
                    market: pair,
                    type: type,
                    side: side,
                    amount: amount,
                    price: price,
                    total: total,
                    status: status,
                    timestamp: timestamp,
                    fee: (total * 0.001).toFixed(2)
                });
            }
            
            return orders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        }

        function setActiveTab(tab) {
            currentTab = tab;
            currentPage = 1;
            
            // Update tab appearance
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tab + 'Tab').classList.add('active');
            
            filterData();
        }

        function filterData() {
            const pairFilter = document.getElementById('pairFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            filteredOrders = allOrders.filter(order => {
                // Status filter
                if (currentTab !== 'all' && order.status !== currentTab) {
                    return false;
                }
                
                // Pair filter
                if (pairFilter && order.market !== pairFilter) {
                    return false;
                }
                
                // Date filter
                if (dateFilter) {
                    const orderDate = new Date(order.timestamp).toISOString().split('T')[0];
                    if (orderDate !== dateFilter) {
                        return false;
                    }
                }
                
                return true;
            });
            
            updateTable();
            updatePagination();
        }

        function updateTable() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageOrders = filteredOrders.slice(startIndex, endIndex);
            
            pageOrders.forEach(order => {
                const row = document.createElement('tr');
                row.className = 'border-b border-border hover:bg-muted/50 transition-colors';
                
                const statusColor = order.status === 'completed' ? 'status-completed' : 
                                  order.status === 'pending' ? 'status-pending' : 'status-cancelled';
                
                const sideColor = order.side === 'buy' ? 'text-chart-2' : 'text-chart-5';
                
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="text-sm">
                            <div>${new Date(order.timestamp).toLocaleDateString()}</div>
                            <div class="text-muted-foreground">${new Date(order.timestamp).toLocaleTimeString()}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2">
                                <span class="text-xs font-bold">${order.market.split('/')[0].charAt(0)}</span>
                            </div>
                            ${order.market}
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 bg-muted rounded text-xs font-medium">${order.type.toUpperCase()}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="${sideColor} font-medium">${order.side.toUpperCase()}</span>
                    </td>
                    <td class="px-6 py-4 text-right">${order.amount.toFixed(6)}</td>
                    <td class="px-6 py-4 text-right">$${order.price.toFixed(2)}</td>
                    <td class="px-6 py-4 text-right font-medium">$${order.total.toFixed(2)}</td>
                    <td class="px-6 py-4 text-center">
                        <span class="px-2 py-1 ${statusColor} rounded text-xs font-medium">${order.status.toUpperCase()}</span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <button onclick="viewOrder('${order.id}')" class="text-primary hover:opacity-80 transition-opacity">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            if (pageOrders.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="9" class="px-6 py-8 text-center text-muted-foreground">
                        <i class="fas fa-inbox text-2xl mb-2"></i>
                        <div>No orders found</div>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function updatePagination() {
            const totalRecords = filteredOrders.length;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, totalRecords);
            
            document.getElementById('totalRecords').textContent = totalRecords;
            document.getElementById('showingStart').textContent = totalRecords > 0 ? startIndex + 1 : 0;
            document.getElementById('showingEnd').textContent = endIndex;
            
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = endIndex >= totalRecords;
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredOrders.length / itemsPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updateTable();
                updatePagination();
            }
        }

        function viewOrder(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) return;
            
            const modal = document.getElementById('orderModal');
            const details = document.getElementById('orderDetails');
            
            details.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="text-sm text-muted-foreground">Order ID</span>
                        <div class="font-medium">${order.id}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted-foreground">Status</span>
                        <div><span class="px-2 py-1 ${order.status === 'completed' ? 'status-completed' : 
                                                        order.status === 'pending' ? 'status-pending' : 'status-cancelled'} rounded text-xs font-medium">
                            ${order.status.toUpperCase()}
                        </span></div>
                    </div>
                    <div>
                        <span class="text-sm text-muted-foreground">Pair</span>
                        <div class="font-medium">${order.market}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted-foreground">Type</span>
                        <div class="font-medium">${order.type.toUpperCase()}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted-foreground">Side</span>
                        <div class="font-medium ${order.side === 'buy' ? 'text-chart-2' : 'text-chart-5'}">${order.side.toUpperCase()}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted-foreground">Amount</span>
                        <div class="font-medium">${order.amount.toFixed(6)}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted-foreground">Price</span>
                        <div class="font-medium">$${order.price.toFixed(2)}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted-foreground">Total</span>
                        <div class="font-medium">$${order.total.toFixed(2)}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted-foreground">Fee</span>
                        <div class="font-medium">$${order.fee}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted-foreground">Date</span>
                        <div class="font-medium">${new Date(order.timestamp).toLocaleString()}</div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeModal() {
            const modal = document.getElementById('orderModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function exportData() {
            // Create CSV content
            const headers = ['Date', 'Pair', 'Type', 'Side', 'Amount', 'Price', 'Total', 'Status', 'Fee'];
            const csvContent = [
                headers.join(','),
                ...filteredOrders.map(order => [
                    new Date(order.timestamp).toISOString(),
                    order.market,
                    order.type,
                    order.side,
                    order.amount,
                    order.price,
                    order.total,
                    order.status,
                    order.fee
                ].join(','))
            ].join('\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lovenx-trading-history-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if logged in
            if (localStorage.getItem('isLoggedIn') !== 'true') {
                window.location.href = 'login.html';
                return;
            }
            
            // Set user name
            const userName = localStorage.getItem('userName') || 'User';
            document.getElementById('userName').textContent = userName;
            
            // Initialize data
            allOrders = generateMockOrders();
            filteredOrders = [...allOrders];
            
            updateTable();
            updatePagination();
            
            // Set today's date as default filter
            document.getElementById('dateFilter').value = new Date().toISOString().split('T')[0];
        });

        // Close modal when clicking outside
        document.getElementById('orderModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>